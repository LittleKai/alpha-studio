const d={avatar:{maxWidth:400,maxHeight:400,maxSizeKB:150,quality:.85,format:"image/jpeg"},featured_work:{maxWidth:1200,maxHeight:800,maxSizeKB:500,quality:.9,format:"image/jpeg"},logo:{maxWidth:600,maxHeight:600,maxSizeKB:300,quality:.92,format:"image/png"},attachment:{maxWidth:1920,maxHeight:1080,maxSizeKB:800,quality:.88,format:"image/jpeg"},general:{maxWidth:1920,maxHeight:1920,maxSizeKB:1024,quality:.9,format:"image/jpeg"}};function h(a){return new Promise((o,r)=>{const t=new Image,e=URL.createObjectURL(a);t.onload=()=>{URL.revokeObjectURL(e),o(t)},t.onerror=()=>{URL.revokeObjectURL(e),r(new Error("Failed to load image"))},t.src=e})}function w(a,o,r,t){let e=a,i=o;if(a>r||o>t){const n=r/a,c=t/o,s=Math.min(n,c);e=Math.floor(a*s),i=Math.floor(o*s)}return{width:e,height:i}}function g(a,o,r){return new Promise((t,e)=>{a.toBlob(i=>{i?t(i):e(new Error("Failed to create blob from canvas"))},o,r)})}async function p(a,o){const r=o.maxSizeKB*1024;let t=o.quality,e=await g(a,o.format,t);for(;e.size>r&&t>.1;)t-=.05,e=await g(a,o.format,t);if(e.size>r&&o.format==="image/png")for(t=o.quality,e=await g(a,"image/jpeg",t);e.size>r&&t>.1;)t-=.05,e=await g(a,"image/jpeg",t);return e}async function x(a,o="general"){if(!a.type.startsWith("image/")||a.type==="image/gif"||a.type==="image/svg+xml")return a;const r=d[o];if(a.size/1024<=r.maxSizeKB)try{const e=await h(a);if(e.width<=r.maxWidth&&e.height<=r.maxHeight)return a}catch{return a}try{const e=await h(a),{width:i,height:n}=w(e.width,e.height,r.maxWidth,r.maxHeight),c=document.createElement("canvas");c.width=i,c.height=n;const s=c.getContext("2d");if(!s)throw new Error("Could not get canvas context");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(e,0,0,i,n);const m=await p(c,r),u=m.type==="image/png"?".png":m.type==="image/webp"?".webp":".jpg",l=`${a.name.replace(/\.[^/.]+$/,"")}_compressed${u}`;return new File([m],l,{type:m.type})}catch(e){return console.error("Image compression error:",e),a}}const y="dzchj4ysj",f="alpha_studio";async function S(a,o,r){try{const t=r?await x(a,r):a,e=new FormData;e.append("file",t),e.append("upload_preset",f),o&&e.append("folder",o);const n=await(await fetch(`https://api.cloudinary.com/v1_1/${y}/image/upload`,{method:"POST",body:e})).json();return n.error?{success:!1,url:"",publicId:"",width:0,height:0,error:n.error.message}:{success:!0,url:n.secure_url,publicId:n.public_id,width:n.width,height:n.height}}catch(t){return console.error("Cloudinary upload error:",t),{success:!1,url:"",publicId:"",width:0,height:0,error:t instanceof Error?t.message:"Unknown error occurred"}}}async function z(a){return new Promise((o,r)=>{const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i?(i.drawImage(t,0,0),o(e.toDataURL("image/png"))):r(new Error("Could not get canvas context"))},t.onerror=()=>r(new Error("Failed to load image")),t.src=a})}export{z as l,S as u};
